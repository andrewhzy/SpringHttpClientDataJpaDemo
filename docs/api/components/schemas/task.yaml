TaskStatus:
  type: string
  enum: [queueing, processing, completed, cancelled, failed]
  description: |
    Task status values:
    - queueing: Task created with parsed data, waiting for background processing
    - processing: Background processing is executing on the parsed rows
    - completed: All rows processed successfully
    - cancelled: Task cancelled by user
    - failed: Background processing failed with error

TaskType:
  type: string
  enum: [chat-evaluation]
  description: |
    Task type values:
    - chat-evaluation: Chat evaluation task with questions and expected answers

Task: 
  type: object
  required:
    - id
    - user_id
    - original_filename
    - sheet_name
    - task_type
    - task_status
    - upload_batch_id
    - row_count
    - processed_rows
    - created_at
    - updated_at
  properties:
    id:
      type: integer
      format: int64
      example: 123
      description: "Unique task identifier (auto-generated)"
    user_id:
      type: string
      example: "system-user"
      description: "ID of the user who created the task"
    original_filename:
      type: string
      example: "monthly_reports.xlsx"
      description: "Original filename of the uploaded Excel file"
    sheet_name:
      type: string
      example: "January_Data"
      description: "Name of the Excel sheet this task was created from"
    task_type:
      $ref: '#/TaskType'
    task_status:
      $ref: '#/TaskStatus'
    upload_batch_id:
      type: integer
      format: int64
      example: 456789
      description: "Groups tasks from the same Excel file upload"
    row_count:
      type: integer
      minimum: 0
      example: 150
      description: "Total number of rows parsed from Excel sheet"
    processed_rows:
      type: integer
      minimum: 0
      example: 75
      description: "Number of rows completed by background processing"
    error_message:
      type: string
      nullable: true
      example: "API timeout on row 15"
      description: "Error message if task failed"
    created_at:
      type: string
      format: date-time
      example: "2024-01-01T00:00:00Z"
      description: "When the task was created"
    updated_at:
      type: string
      format: date-time
      example: "2024-01-01T00:05:00Z"
      description: "When the task was last updated"
    started_at:
      type: string
      format: date-time
      nullable: true
      example: "2024-01-01T00:01:00Z"
      description: "When background processing started"
    completed_at:
      type: string
      format: date-time
      nullable: true
      example: "2024-01-01T00:10:00Z"
      description: "When background processing completed successfully"
    cancelled_at:
      type: string
      format: date-time
      nullable: true
      description: "When the task was cancelled"
    failed_at:
      type: string
      format: date-time
      nullable: true
      description: "When the task failed"

TaskList:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/Task'
    meta:
      $ref: './pagination.yaml#/PaginationMeta'

UploadResponse:
  type: object
  required:
    - upload_batch_id
    - filename
    - tasks
    - total_sheets
    - message
  properties:
    upload_batch_id:
      type: string
      format: uuid
      example: "456e7890-e89b-12d3-a456-426614174000"
      description: "UUID for this upload batch"
    filename:
      type: string
      example: "monthly_reports.xlsx"
      description: "Original filename of uploaded Excel file"
    tasks:
      type: array
      items:
        type: object
        required:
          - task_id
          - sheet_name
          - task_type
          - status
          - row_count
        properties:
          task_id:
            type: string
            example: "123"
            description: "Generated task ID"
          filename:
            type: string
            example: "monthly_reports.xlsx"
            description: "Original filename"
          sheet_name:
            type: string
            example: "January_Data"
            description: "Excel sheet name"
          task_type:
            type: string
            example: "chat-evaluation"
            description: "Type of task created"
          status:
            type: string
            example: "queueing"
            description: "Initial task status"
          row_count:
            type: integer
            example: 150
            description: "Number of rows parsed from this sheet"
    total_sheets:
      type: integer
      example: 3
      description: "Number of sheets processed"
    message:
      type: string
      example: "Successfully created 3 tasks with 450 total questions"
      description: "Success message with summary"

TaskStats:
  type: object
  properties:
    total_tasks:
      type: integer
      example: 25
    pending_tasks:
      type: integer
      example: 5
    processing_tasks:
      type: integer
      example: 3
    completed_tasks:
      type: integer
      example: 15
    cancelled_tasks:
      type: integer
      example: 1
    failed_tasks:
      type: integer
      example: 1
    total_upload_batches:
      type: integer
      example: 8
    chat_evaluation_tasks:
      type: integer
      example: 25

TaskWithData:
  allOf:
    - $ref: '#/Task'
    - type: object
      properties:
        input_data:
          type: array
          items:
            $ref: './chat-evaluation.yaml#/ChatEvaluationInputData'
          description: "Input data for chat evaluation tasks"
        results_data:
          type: array
          items:
            $ref: './chat-evaluation.yaml#/ChatEvaluationOutputData'
          nullable: true
          description: "Results data (null if processing not completed)"
        results_excel_file:
          type: object
          nullable: true
          description: "Excel file containing all evaluation results (null if processing not completed)"
          properties:
            filename:
              type: string
              example: "task_123_evaluation_results.xlsx"
              description: "Generated Excel filename"
            content:
              type: string
              format: byte
              description: "Base64-encoded Excel file content"
            size:
              type: integer
              example: 15360
              description: "File size in bytes"
            mime_type:
              type: string
              example: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            generated_at:
              type: string
              format: date-time
              example: "2024-01-01T00:10:00Z"
              description: "When the Excel file was generated" 